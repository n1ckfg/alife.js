document=document||("undefined"!=typeof window&&void 0!==window.document?window.document:{}),random=function(t){return void 0!==t?Math.floor(Math.random()*t):Math.random()},srandom=function(t){return"number"==typeof t?random(2*t)-t:2*random()-1},shuffle=function(t){for(var e,i,n=t.length;n;n--)e=Math.floor(Math.random()*n),i=t[n-1],t[n-1]=t[e],t[e]=i;return t},isarraylike=function(t){return Array.isArray(t)||t instanceof Float32Array},wrap=function(t,e){return(t%e+e)%e},clamp=function(t,e,i){return Math.min(Math.max(t,e),i)};class FPS{constructor(){this.t0=.001*performance.now(),this.t=0,this.fps=60,this.dt=1/this.fps,this.dtavg=this.dt,this.fpsavg=this.fps}reset(){this.t0=this.t,this.t=0}tick(){var t=.001*performance.now()-this.t0;this.dt=t-this.t,this.fps=1/this.dt;var e=Math.min(1,Math.max(.001,this.dtavg));this.dtavg+=e*(this.dt-this.dtavg),this.fpsavg+=e*(this.fps-this.fpsavg),this.t=t}}let canvas=document.createElement("canvas"),ctx=canvas.getContext("2d"),ctxtransform=[1,0,0,1,0,0],ctxpixelscale=1,overlay=document.createElement("div");document.body.style.margin="0px",document.body.style.padding="0px",document.body.style.backgroundColor="#111",document.body.appendChild(canvas),document.body.appendChild(overlay);let pretext="",fps=new FPS;function render(){0==fps.t&&"function"==typeof reset&&reset(),fps.tick(),now=fps.t,updating&&"function"==typeof update&&update(fps.dt),"function"==typeof draw&&(ctx.resetTransform(),ctx.clearRect(0,0,window.innerWidth,window.innerHeight),ctx.setTransform(ctxtransform[0],ctxtransform[1],ctxtransform[2],ctxtransform[3],ctxtransform[4],ctxtransform[5]),ctxpixelscale=1/ctxtransform[0],ctx.lineWidth=ctxpixelscale,ctx.fillStyle="white",ctx.strokeStyle="white",draw(ctx)),""!==pretext&&(overlay.innerText=pretext,pretext=""),requestAnimationFrame(render)}function requestFullscreen(){var t=document.documentElement;let e=t.requestFullscreen;e=e||t.mozRequestFullScreen,e=e||t.webkitRequestFullscreen,e=e||t.webkitRequestFullScreen,e=e||t.msRequestFullscreen,/ Version\/5\.1(?:\.\d+)? Safari\//.test(navigator.userAgent)?e.apply(t):e.apply(t,Element.ALLOW_KEYBOARD_INPUT)}function exitFullscreen(){var t=document.documentElement;let e=t.exitFullscreen;e=e||t.webkitExitFullscreen,e=e||t.webkitCancelFullScreen,e=e||t.mozCancelFullScreen,e=e||t.msExitFullscreen,e.apply(t)}now=0,updating=!0,saveCanvasToPNG=function(t="canvas_image"){let e=document.createElement("a"),i=canvas.toDataURL({format:"png",multiplier:4});i.substr(22,i.length);var n=function(t){let e=t.split(","),i=e[0].match(/:(.*?);/)[1],n=atob(e[1]),r=n.length,o=new Uint8Array(r);for(;r--;)o[r]=n.charCodeAt(r);return new Blob([o],{type:i})}(i),n=URL.createObjectURL(n);e.download=t+".png",e.href=n,e.target="_blank",e.click()},write=function(){for(let t=0;t<arguments.length;t++){var e=arguments[t];pretext+="string"==typeof e?e+"\t":JSON.stringify(e)+"\t"}pretext+="\n"},requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t,e){return window.setTimeout(t,1e3/60)},cancelRequestAnimationFrame=window.cancelCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.clearTimeout,onresize=function(){canvas.width=window.innerWidth,canvas.height=window.innerHeight,canvas.style.width=canvas.width+"px",canvas.style.height=canvas.height+"px",canvas.style.position="absolute",canvas.style.top="0px",canvas.style.bottom="0px",canvas.style.left="0px",canvas.style.right="0px",canvas.style.margin="auto",canvas.style.cursor="crosshair",canvas.tabindex="0",canvas.contentEditable=!0,overlay.width=window.innerWidth,overlay.height=window.innerHeight,overlay.style.width=canvas.width+"px",overlay.style.height=canvas.height+"px",overlay.style.position="absolute",overlay.style.top="0px",overlay.style.bottom="0px",overlay.style.left="0px",overlay.style.right="0px",overlay.style.margin="auto",overlay.style.color="grey",overlay.style["pointer-events"]="none",overlay.style["font-family"]="monospace",overlay.style["white-space"]="pre-wrap";let t,e,i;ctxtransform=(i=draw2D.isFillWindow?(t=Math.max(canvas.width,canvas.height),e=Math.min(0,(canvas.width-t)/2),Math.min(0,(canvas.height-t)/2)):(t=Math.min(canvas.width,canvas.height),e=Math.max(0,(canvas.width-t)/2),Math.max(0,(canvas.height-t)/2)),[t,0,0,t,e,i]),ctx.resetTransform(),ctx.clearRect(0,0,window.innerWidth,window.innerHeight),ctx.setTransform(ctxtransform[0],ctxtransform[1],ctxtransform[2],ctxtransform[3],ctxtransform[4],ctxtransform[5]),ctxpixelscale=1/ctxtransform[0],ctx.lineWidth=ctxpixelscale,ctx.fillStyle="white",ctx.strokeStyle="white"};let mouseevent=function(t,e){var i,n;"function"==typeof mouse&&(t.preventDefault(),i=[(t.offsetX-ctxtransform[4])/ctxtransform[0],(t.offsetY-ctxtransform[5])/ctxtransform[3]],n=0,n="buttons"in t?t.buttons:t.which||t.button,mouse(e,i,n,t))},keyevent=function(e,i,n){var r=e.key||e.keyCode;"function"==typeof key&&key(i,r),"function"==typeof n&&n(r);r=String.fromCharCode(r).replace(/[^ -~]+/g,"");if(""!==r){"function"==typeof key&&key(i,r),"function"==typeof n&&n(r);let t="";e.ctrlKey&&(t+="ctrl-"),e.altKey&&(t+="alt-"),e.shiftKey&&(t+="shift-"),""!==t&&("function"==typeof key&&key(i,t+r),"function"==typeof n&&n(t+r))}};field2D=function(t,e){void 0===t&&(t=64),void 0===e&&(e=t),this.width=t,this.height=e,this.length=this.width*this.height,this.smooth=!1,this.canvas=document.createElement("canvas"),this.canvas.width=t,this.canvas.height=e,this.ctx=this.canvas.getContext("2d"),this.imgdata=this.ctx.getImageData(0,0,t,e),this.data=this.imgdata.data,this.array=new Float32Array(this.width*this.height*4),this.clear()},field2D.prototype.clone=function(){let t=new field2D(this.width,this.height);for(var e=0,i=this.array.length;e<i;e++)t.array[e]=this.array[e];return t},field2D.prototype.copy=function(t){if(this.width==t.width&&this.height==t.height){for(var e=0,i=this.array.length;e<i;e++)this.array[e]=t.array[e];return this}console.error("fields must have same dimensions to copy")},field2D.prototype.clear=function(){const i=this.array;for(let t=0,e=i.length;t<e;t+=4)i[t]=0,i[t+1]=0,i[t+2]=0,i[t+3]=1;return this},field2D.prototype.get=function(t,e){t=wrap(t,this.width),e=wrap(e,this.height);return this.array[4*(e*this.width+t)]},field2D.prototype.cell=function(t,e){t=wrap(t,this.width);t=4*((e=wrap(e,this.height))*this.width+t);return this.array.subarray(t,4+t)},field2D.prototype.rawset=function(t,e,i){var n;return"number"==typeof t?(n=4*(i*this.width+e),this.array[n]=t,this.array[1+n]=t,this.array[2+n]=t,this.array[3+n]=1):isarraylike(t)&&(e=4*(i*this.width+e),"number"==typeof t[0]&&(this.array[e]=t[0]),"number"==typeof t[1]&&(this.array[1+e]=t[1]),"number"==typeof t[2]&&(this.array[2+e]=t[2]),"number"==typeof t[3]&&(this.array[3+e]=t[3])),this},field2D.prototype.set=function(i,t,e){if(void 0!==t&&void 0!==e)return t=wrap(t,this.width),e=wrap(e,this.height),"function"==typeof i&&(i=i.call(this,t,e)),this.rawset(i,t,e);if("function"==typeof i)for(let e=0;e<this.height;++e)for(let t=0;t<this.width;++t)this.rawset(i.call(this,t,e),t,e);else if("number"==typeof i)for(let e=0;e<this.height;++e)for(let t=0;t<this.width;++t){var n=4*(e*this.width+t);this.array[n]=i,this.array[1+n]=i,this.array[2+n]=i,this.array[3+n]=1}else if(isarraylike(i))for(let e=0;e<this.height;++e)for(let t=0;t<this.width;++t){var r=4*(e*this.width+t);0<i.length&&i[0];"number"==typeof i[0]&&(this.array[r]=i[0]),"number"==typeof i[1]&&(this.array[1+r]=i[1]),"number"==typeof i[2]&&(this.array[2+r]=i[2]),"number"==typeof i[3]&&(this.array[3+r]=i[3])}return this},field2D.prototype.map=function(i){var n=this.array,r=this.width,t=this.height;for(let e=0;e<t;e++)for(let t=0;t<r;t++){var o=i(n[4*(e*r+t)],t,e);void 0!==o&&this.rawset(o,t,e)}return this},field2D.prototype.cell=function(t,e){t=wrap(t,this.width);t=4*((e=wrap(e,this.height))*this.width+t);return this.array.subarray(t,4+t)},field2D.prototype.reduce=function(i,n){var r=this.array,o=this.width,t=this.height;for(let e=0;e<t;e++)for(let t=0;t<o;t++)n=i(n,r[4*(e*o+t)]);return n},field2D.prototype.sum=function(){return this.reduce(function(t,e){return t+e},0)},field2D.prototype.max=function(){return this.reduce(Math.max,Number.NEGATIVE_INFINITY)},field2D.prototype.min=function(){return this.reduce(Math.min,Number.MAX_VALUE)},field2D.prototype.scale=function(i){let n=this.array;for(let t=0,e=n.length;t<e;t+=4)n[t]*=i,n[t+1]*=i,n[t+2]*=i;return this},field2D.prototype.mul=field2D.prototype.scale,field2D.prototype.offset=function(i){let n=this.array;for(let t=0,e=n.length;t<e;t+=4)n[t]+=i,n[t+1]+=i,n[t+2]+=i;return this},field2D.prototype.add=field2D.prototype.offset,field2D.prototype.normalize=function(){let e=this.array;this.width,this.height;var i=e.length;let n=Math.min(e[0],e[1],e[2]),r=Math.max(e[0],e[1],e[2]);for(let t=4;t<i;t+=4)n=Math.min(n,e[t],e[t+1],e[t+2]),r=Math.max(r,e[t],e[t+1],e[t+2]);var t=r-n;if(0<t){var o=1/t;for(let t=0;t<i;t+=4)e[t]=o*(e[t]-n),e[t+1]=o*(e[t+1]-n),e[t+2]=o*(e[t+2]-n)}return this},field2D.prototype.sample=function(t,e,i){if("object"==typeof t&&(i=e,e=t[1],t=t[0]),"number"!=typeof t||"number"!=typeof e)return error("attempt to get field cell with invalid coordinate type"),0;i="number"!=typeof i?0:wrap(i,4);var n=this.array;t=wrap(t*this.width-.5,this.width),e=wrap(e*this.height-.5,this.height);var r=Math.floor(t),o=Math.floor(e),a=wrap(r+1,this.width),s=wrap(o+1,this.height),h=t-r,c=e-o,t=1-h,e=1-c;return n[4*(o*this.width+r)+i]*t*e+n[4*(o*this.width+a)+i]*h*e+n[4*(s*this.width+r)+i]*t*c+n[4*(s*this.width+a)+i]*h*c},field2D.prototype.deposit=function(t,e,i,n){if("object"==typeof e&&(n=i,i=e[1],e=e[0]),"number"!=typeof e||"number"!=typeof i)return error("attempt to get field cell with invalid coordinate type"),0;const r=this.array;e=wrap(e*this.width-.5,this.width),i=wrap(i*this.height-.5,this.height);var o=Math.floor(e),a=Math.floor(i),s=wrap(o+1,this.width),h=wrap(a+1,this.height),c=4*(a*this.width+o),l=4*(a*this.width+s),u=4*(h*this.width+o),p=4*(h*this.width+s),f=e-o,v=i-a,y=1-f,m=1-v;let d=0,w=4;"number"==typeof n?(d="number"!=typeof n?0:wrap(n,4),w=d+1):isarraylike(t)&&void 0!==t.length&&(w=t.length);for(var g,x,b,M,k=d;k<w;k++){const C=t;isarraylike(t)&&(C=C[k]),void 0!==C&&(g=r[c+k],x=r[l+k],b=r[u+k],M=r[p+k],r[c+k]=g+y*m*C,r[l+k]=x+f*m*C,r[u+k]=b+y*v*C,r[p+k]=M+f*v*C)}return this},field2D.prototype.update=function(t,e,i,n){const r=this.array;if("object"==typeof e&&(n=i,i=e[1],e=e[0]),"number"!=typeof e||"number"!=typeof i){if("function"!=typeof t)return this.set(t);{const z=t;var o=this.height,a=this.width,s=1/a,h=1/o;const A=new vec2;for(var c=0;c<o;c++)for(var l=0;l<a;l++){A[0]=(l+.5)*s,A[1]=(c+.5)*h;var u=4*(c*a+l),u=r.subarray(u,4+u);this.rawset(z(u,A),l,c)}return this}}e=wrap(e*this.width-.5,this.width),i=wrap(i*this.height-.5,this.height);var p=Math.floor(e),f=Math.floor(i),v=wrap(p+1,this.width),y=wrap(f+1,this.height),m=4*(f*this.width+p),d=4*(f*this.width+v),w=4*(y*this.width+p),g=4*(y*this.width+v),x=e-p,b=i-f,M=1-x,k=1-b;let C=0,S=4;"number"==typeof n&&(C="number"!=typeof n?0:wrap(n,4),S=C+1);for(var _,D,F,H,E=C;E<S;E++){const j=t;isarraylike(t)&&(j=j[n]),void 0!==j&&(_=r[m+E],D=r[d+E],F=r[w+E],H=r[g+E],r[m+E]=_+M*k*(j-_),r[d+E]=D+x*k*(j-D),r[w+E]=F+M*b*(j-F),r[g+E]=H+x*b*(j-H))}return this},field2D.prototype.diffuse=function(t,e,i){const n=this.array;i="number"==typeof i?i:10;var r=t.array,o=1/(1+4*(e="number"==typeof e?e:.1)),a=t.width,s=t.height;if(a!=this.width||s!=this.height)return console.log("field2D.diffuse(): field dims do not match."),this;for(var h=1;h<i;h++)for(var c=0;c<s;c++)for(var l=0;l<a;l++){var u=4*(c*a+l),p=4*(wrap(c-1,s)*a+l),f=4*(c*a+wrap(l-1,a)),v=4*(wrap(c+1,s)*a+l),y=4*(c*a+wrap(l+1,a));for(let t=0;t<4;t++){var m=r[u+t],d=n[f+t]+n[y+t]+n[p+t]+n[v+t];n[u+t]=o*(m+e*d)}}return this},field2D.prototype.draw=function(){for(let t=0,e=this.array.length;t<e;t++)this.data[t]=Math.floor(255*clamp(this.array[t],0,1));this.ctx.putImageData(this.imgdata,0,0);var t=Math.max(this.canvas.width,this.canvas.height);return ctx.imageSmoothingEnabled=this.smooth,ctx.mozImageSmoothingEnabled=ctx.imageSmoothingEnabled,ctx.webkitImageSmoothingEnabled=ctx.imageSmoothingEnabled,ctx.msImageSmoothingEnabled=ctx.imageSmoothingEnabled,ctx.drawImage(this.canvas,0,0,t,t,0,0,1,1),this},field2D.prototype.loadImage=function(t,e){let i=this,n=new Image;n.crossOrigin="",n.onload=function(){i.ctx.drawImage(n,0,0,this.width,this.height,0,0,i.width,i.height),i.imgdata=i.ctx.getImageData(0,0,i.width,i.height),i.data=i.imgdata.data;for(let t=0,e=i.array.length;t<e;t++)i.array[t]=i.data[t]/255;e&&e.apply(i)},n.src=t},vec2=function(t,e){this[0]=t||0,this[1]=void 0!==e?e:this[0]},vec2.create=function(t,e){return new vec2(t,e)},vec2.clone=function(t){var e=new vec2;return"object"==typeof t?(e[0]=t[0],e[1]=t[1]):"number"==typeof t&&(e[0]=t,e[1]=t),e},vec2.len=function(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])},vec2.angle=function(t){return Math.atan2(t[1],t[0])},vec2.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]},vec2.distance=function(t,e){e=[t[0]-e[0],t[1]-e[1]];return Math.sqrt(e[0]*e[0]+e[1]*e[1])},vec2.anglebetween=function(t,e){return 0<vec2.len(t)*vec2.len(e)?Math.acos(vec2.dot(t,e)/(vec2.len(t)*vec2.len(e))):0},vec2.oob=function(t,e,i){return void 0===i&&(i=e,e=0),t[0]<e||t[0]>=i||t[1]<e||t[1]>=i},vec2.equals=function(t,e){return t[0]==e[0]&&t[1]==e[1]},vec2.set=function(t,e,i){return"object"==typeof e?(t[0]=e[0],t[1]=e[1]):"number"==typeof e&&(t[0]=e,t[1]=void 0!==i?i:e),t},vec2.setmag=function(t,e,i){var n=vec2.len(e);return 0<n&&(t[0]=e[0]*(n=i/n),t[1]=e[1]*n),t},vec2.setangle=function(t,e,i){e=vec2.len(e);return t[0]=e*Math.cos(i),t[1]=e*Math.sin(i),t},vec2.add=function(t,e,i){return"object"==typeof i?(t[0]=e[0]+i[0],t[1]=e[1]+i[1]):"number"==typeof i&&(t[0]=e[0]+i,t[1]=e[1]+i),t},vec2.sub=function(t,e,i){return"object"==typeof i?(t[0]=e[0]-i[0],t[1]=e[1]-i[1]):"number"==typeof i&&(t[0]=e[0]-i,t[1]=e[1]-i),t},vec2.absdiff=function(t,e,i){return"object"==typeof i?(t[0]=Math.abs(e[0]-i[0]),t[1]=Math.abs(e[1]-i[1])):"number"==typeof i&&(t[0]=Math.abs(e[0]-i),t[1]=Math.abs(e[1]-i)),t},vec2.mul=function(t,e,i){return"object"==typeof i?(t[0]=e[0]*i[0],t[1]=e[1]*i[1]):"number"==typeof i&&(t[0]=e[0]*i,t[1]=e[1]*i),t},vec2.div=function(t,e,i){return"object"==typeof i?(t[0]=e[0]/i[0],t[1]=e[1]/i[1]):"number"==typeof i&&(t[0]=e[0]/i,t[1]=e[1]/i),t},vec2.wrap=function(t,e,i,n){var r=1,o=1;return"object"==typeof i?(r=i[0],o=i[1]):"number"==typeof i&&(r=i,o="number"==typeof n?n:r),t[0]=wrap(e[0],r),t[1]=wrap(e[1],o),t},vec2.lesser=function(t,e,i){return"object"==typeof i?(t[0]=(Math.abs(e[0])<Math.abs(i[0])?e:i)[0],t[1]=(Math.abs(e[1])<Math.abs(i[1])?e:i)[1]):"number"==typeof i&&(t[0]=Math.abs(e[0])<Math.abs(i)?e[0]:i,t[1]=Math.abs(e[1])<Math.abs(i)?e[1]:i),t},vec2.greater=function(t,e,i){return"object"==typeof i?(t[0]=(Math.abs(e[0])>=Math.abs(i[0])?e:i)[0],t[1]=(Math.abs(e[1])>=Math.abs(i[1])?e:i)[1]):"number"==typeof i&&(t[0]=Math.abs(e[0])>=Math.abs(i)?e[0]:i,t[1]=Math.abs(e[1])>=Math.abs(i)?e[1]:i),t};let fold2=function(n,r){return r=r||0,function(t,e,i){return"object"==typeof i?(t[0]=n(e[0],i[0]),t[1]=n(e[1],i[1])):"number"==typeof i?(t[0]=n(e[0],i),t[1]=n(e[1],i)):(t[0]=n(e[0],r),t[1]=n(e[1],r)),t}};vec2.pow=fold2(Math.pow,1),vec2.min=fold2(Math.min,1),vec2.max=fold2(Math.max,0),vec2.clip=function(t,e,i,n){return void 0===n&&(n=i,i=0),vec2.max(t,vec2.min(t,e,n),i)},vec2.clamp=vec2.clip,vec2.mix=function(t,e,i,n){if("object"==typeof n){n[0],n[1];return t[0]=e[0]*(1-n[0])+i[0]*n[0],t[1]=e[1]*(1-n[1])+i[1]*n[1],t}var r=1-(n="number"==typeof n?n:.5);return t[0]=e[0]*r+i[0]*n,t[1]=e[1]*r+i[1]*n,t},vec2.relativewrap=function(t,e,i,n){var r=1,o=1;"object"==typeof i?(r=i[0],o=i[1]):"number"==typeof i&&(r=i,o="number"==typeof n?n:r);i=.5*r,n=.5*o;return t[0]=wrap(e[0]+i,r)-i,t[1]=wrap(e[1]+n,o)-n,t},vec2.normalize=function(t,e){e=vec2.len(e);return 0<e?(t[0]/=e,t[1]/=e,t):t.random()},vec2.negate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t},vec2.floor=function(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t},vec2.ceil=function(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t},vec2.round=function(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t},vec2.limit=function(t,e,i){e=vec2.dot(e,e);return i*i<e&&(e=i/Math.sqrt(e),t[0]*=e,t[1]*=e),t},vec2.rotate=function(t,e,i){var n=Math.cos(i),r=Math.sin(i),i=e[0],e=e[1];return t[0]=i*n-e*r,t[1]=e*n+i*r,t},vec2.mag=vec2.len,vec2.magnitude=vec2.len,vec2.setlen=vec2.setmag,vec2.setlength=vec2.setmag,vec2.setmagnitude=vec2.setmag,vec2.dist=vec2.distance,vec2.copy=vec2.clone,vec2.translate=vec2.add,vec2.scale=vec2.mul,vec2.subtract=vec2.sub,vec2.multiply=vec2.mul,vec2.divide=vec2.div,vec2.clamp=vec2.clip,vec2.lerp=vec2.mix,vec2.prototype.fromAngle=function(t){return t=void 0!==t?t:0,this[0]=Math.cos(t),this[1]=Math.sin(t),this},vec2.prototype.fromPolar=function(t,e){return e=void 0!==e?e:0,this[0]=(t=void 0!==t?t:1)*Math.cos(e),this[1]=t*Math.sin(e),this},vec2.prototype.random=function(t){t=void 0!==t?t:1;var e=random()*Math.PI*2;return this[0]=Math.cos(e)*t,this[1]=Math.sin(e)*t,this},vec2.prototype.len=function(t){return void 0!==t?vec2.setmag(this,this,t):vec2.len(this)},vec2.prototype.angle=function(t){return void 0!==t?vec2.setangle(this,this,t):vec2.angle(this)},vec2.prototype.distance=function(t){return vec2.distance(this,t)},vec2.prototype.anglebetween=function(t){return vec2.anglebetween(this,t)},vec2.prototype.oob=function(t,e){return vec2.oob(this,t,e)},vec2.prototype.dot=function(t){return vec2.dot(this,t)},vec2.prototype.equals=function(t){return vec2.equals(this,t)},vec2.prototype.set=function(t,e){return vec2.set(this,t,e)},vec2.prototype.clone=function(){return vec2.clone(this)},vec2.prototype.setmag=function(t){return vec2.setmag(this,this,t)},vec2.prototype.setangle=function(t){return vec2.setangle(this,this,t)},vec2.prototype.add=function(t){return vec2.add(this,this,t)},vec2.prototype.sub=function(t){return vec2.sub(this,this,t)},vec2.prototype.absdiff=function(t){return vec2.absdiff(this,this,t)},vec2.prototype.mul=function(t){return vec2.mul(this,this,t)},vec2.prototype.div=function(t){return vec2.div(this,this,t)},vec2.prototype.pow=function(t,e){return vec2.pow(this,this,t,e)},vec2.prototype.max=function(t,e){return vec2.max(this,this,t,e)},vec2.prototype.min=function(t,e){return vec2.min(this,this,t,e)},vec2.prototype.greater=function(t){return vec2.greater(this,this,t)},vec2.prototype.lesser=function(t){return vec2.lesser(this,this,t)},vec2.prototype.clip=function(t,e){return vec2.clip(this,this,t,e)},vec2.prototype.mix=function(t,e){return vec2.mix(this,this,t,e)},vec2.prototype.wrap=function(t,e){return vec2.wrap(this,this,t,e)},vec2.prototype.relativewrap=function(t,e){return vec2.relativewrap(this,this,t,e)},vec2.prototype.normalize=function(){return vec2.normalize(this,this)},vec2.prototype.negate=function(){return vec2.negate(this,this)},vec2.prototype.floor=function(){return vec2.floor(this,this)},vec2.prototype.ceil=function(){return vec2.ceil(this,this)},vec2.prototype.round=function(){return vec2.round(this,this)},vec2.prototype.limit=function(t){return vec2.limit(this,this,t)},vec2.prototype.rotate=function(t){return vec2.rotate(this,this,t)},vec2.prototype.mag=vec2.prototype.len,vec2.prototype.magnitude=vec2.prototype.len,vec2.prototype.setlen=vec2.prototype.setmag,vec2.prototype.setlength=vec2.prototype.setmag,vec2.prototype.setmagnitude=vec2.prototype.setmag,vec2.prototype.dist=vec2.prototype.distance,vec2.prototype.copy=vec2.prototype.clone,vec2.prototype.translate=vec2.prototype.add,vec2.prototype.scale=vec2.prototype.mul,vec2.prototype.subtract=vec2.prototype.sub,vec2.prototype.multiply=vec2.prototype.mul,vec2.prototype.divide=vec2.prototype.div,vec2.prototype.clamp=vec2.prototype.clip,vec2.prototype.lerp=vec2.prototype.mix;let make_vec2_fun=function(t){return function(){return t.apply(new vec2,arguments)}},constructor_names=["random","fromAngle","fromPolar"];for(var i=0;i<constructor_names.length;i++){var k=constructor_names[i],f=vec2.prototype[k];vec2[constructor_names[i]]=make_vec2_fun(f)}draw2D={isFillWindow:!1,fitToWindow(t){this.isFillWindow=!t,onresize()},push(){return ctx.save(),this},pop(){return ctx.restore(),this},scale(...t){let e=1,i=1;var n=t[0];return"object"==typeof n?(e=null!=n[0]?n[0]:1,i=null!=n[1]?n[1]:1):"number"==typeof n&&(e=n,i=null!=t[1]?t[1]:e),ctx.scale(e,i),this},rotate(...t){t=t[0];return"object"==typeof t?ctx.rotate(vec2.angle(t)):"number"==typeof t&&ctx.rotate(t),this},translate(...t){let e=0,i=0;var n=t[0];return"object"==typeof n?(e=n[0]||0,i=n[1]||0):"number"==typeof n&&(e=n,i=t[1]||0),ctx.translate(e,i),this},rect(...t){let e=0,i=0,n=1,r=1;var o=t[0];return"object"==typeof o?(n=null!=t[1]?t[1]:1,r=null!=t[2]?t[2]:n,e=o[0]||0,i=o[1]||0):"number"==typeof o&&(n=o,r=null!=t[1]?t[1]:n),ctx.fillRect(e-.5*n,i-.5*r,n,r),this},circle(...t){let e=0,i=0,n=1,r=1;var o=t[0];return"object"==typeof o?(n=null!=t[1]?t[1]:1,r=null!=t[2]?t[2]:n,e=o[0]||0,i=o[1]||0):"number"==typeof o&&(n=o,r=null!=t[1]?t[1]:n),ctx.beginPath(),ctx.ellipse(e,i,.5*n,.5*r,0,-Math.PI,Math.PI),ctx.fill(),this},triangle(...t){let e=0,i=0,n=1,r=1;var o=t[0];"object"==typeof o?(n=null!=t[1]?t[1]:1,r=null!=t[2]?t[2]:n,e=o[0]||0,i=o[1]||0):"number"==typeof o&&(n=o,r=null!=t[1]?t[1]:n);o=.5*n,t=.5*r;return ctx.beginPath(),ctx.moveTo(e-o,i-t),ctx.lineTo(e+o,i),ctx.lineTo(e-o,i+t),ctx.fill(),this},line(...t){let e=t[t.length-1];"number"!=typeof e&&(e=1);let i=t[1];"object"!=typeof i&&(i=[0,0]);let n=t[0];"object"!=typeof n&&(n=[0,0]),ctx.lineWidth=e/ctxtransform[0],ctx.beginPath(),ctx.moveTo(n[0],n[1]),ctx.lineTo(i[0],i[1]),ctx.stroke()},lines(e,t=1){if(ctx.lineWidth=t/ctxtransform[0],!(e.length<2)){ctx.beginPath();for(let t=0;t<e.length;t+=2)ctx.moveTo(e[t][0],e[t][1]),ctx.lineTo(e[t+1][0],e[t+1][1]);ctx.stroke()}},color(...t){let e=t[0];var i;"string"==typeof e?(ctx.fillStyle=e,ctx.strokeStyle=e):"number"==typeof e?(i=255*e,e=4<=t.length?`rgba(${i}, ${255*t[1]}, ${255*t[2]}, ${t[3]})`:3==t.length?`rgb(${i}, ${255*t[1]}, ${255*t[2]})`:2==t.length?`rgba(${i}, ${i}, ${i}, ${t[1]})`:`rgb(${i}, ${i}, ${i})`,ctx.fillStyle=e,ctx.strokeStyle=e):"object"==typeof e?draw2D.color.apply(this,e):(ctx.fillStyle="white",ctx.strokeStyle="white")},hsl(...t){let e=t[0];var i;"number"==typeof e?(i=360*e,e=4<=t.length?`hsla(${i}, ${100*t[1]}%, ${100*t[2]}%, ${t[3]})`:3==t.length?`hsl(${i}, ${100*t[1]}%, ${100*t[2]}%)`:2==t.length?`hsla(${i}, 50%, 50%, ${t[1]})`:`hsl(${i}, 50%, 50%)`,ctx.fillStyle=e,ctx.strokeStyle=e):"object"==typeof e?draw2D.hsl.apply(this,e):(ctx.fillStyle="white",ctx.strokeStyle="white")}};class hashspace2D{constructor(t){null==t&&(t=16),this.numCellsH=Math.round(t),this.numCellsV=Math.round(t),this.rCellSize=t,this.cellSize=1/t,this.width=this.numCellsH*this.cellSize,this.height=this.numCellsV*this.cellSize,this.maxRadius=Math.min(this.width,this.height)/2,this.numCells=this.numCellsH*this.numCellsV,this.clear();let i=[];var n=Math.floor(this.numCellsV/2),r=Math.floor(this.numCellsH/2),o=this.maxRadius*this.maxRadius;for(let e=0;e<this.numCellsV;e++)for(let t=0;t<this.numCellsH;t++){var a=((e-n)*(e-n)+(t-r)*(t-r))*(this.cellSize*this.cellSize);a<o&&i.push({v:e-n,h:t-r,radius2:a})}i.sort((t,e)=>t.radius2-e.radius2),this.shells=i}clear(){this.cells=[];for(let t=0;t<this.numCells;t++)this.cells[t]=[];return this}insertPoint(t){var e=t.pos[0],i=t.pos[1],n=1/this.cellSize,e=Math.max(Math.min(~~(e*n),this.numCellsH-1),0),n=Math.max(Math.min(~~(i*n),this.numCellsV-1),0);return t.__spacehash={cellH:e,cellV:n},this.cells[n*this.numCellsH+e].push(t),this}removePoint(t){if(t.__spacehash){var e=t.__spacehash.cellV,i=t.__spacehash.cellH,i=e*this.numCellsH+i,i=this.cells[i],t=i.indexOf(t);return-1!==t&&i.splice(t,1),this}}updatePoint(t){var e=t.__spacehash.cellV,i=t.__spacehash.cellH,n=e*this.numCellsH+i,r=t.pos[0],o=t.pos[1],e=1/this.cellSize,i=Math.max(Math.min(~~(r*e),this.numCellsH-1),0),r=Math.max(Math.min(~~(o*e),this.numCellsV-1),0),o=r*this.numCellsH+i;if(o!==n){e=this.cells[n],n=e.indexOf(t);return-1!==n&&e.splice(n,1),t.__spacehash.cellH=i,t.__spacehash.cellV=r,this.cells[o].push(t),this}}insert(t){var e,i,n=t.pos[0]-t.size,r=t.pos[0]+t.size,o=t.pos[1]-t.size,a=t.pos[1]+t.size,s=1/this.cellSize,h=Math.max(Math.min(~~(n*s),this.numCellsH-1),0),o=Math.max(Math.min(~~(o*s),this.numCellsH-1),0),c=Math.max(Math.min(~~(r*s),this.numCellsH-1),0),l=Math.max(Math.min(~~(a*s),this.numCellsH-1),0);for(t.__spacehash={cellH:h,cellV:o,cellV2:l,cellH2:c},e=o;e<=l;e++)for(i=h;i<=c;i++)this.cells[e*this.numCellsH+i].push(t);return this}remove(t){if(t.__spacehash){for(var e,i,n,r=t.__spacehash.cellH,o=t.__spacehash.cellH2,a=t.__spacehash.cellV,s=t.__spacehash.cellV2,h=a;h<=s;h++)for(e=r;e<=o;e++)n=h*this.numCellsH+e,-1!==(i=this.cells[n].indexOf(t))&&this.cells[n].splice(i,1);return this}}update(t){return this.remove(t).insert(t)}searchPosition(t,e){for(var i,n,r,o,a,s,h,c,l=1/this.cellSize,u=t[0]*l,p=t[1]*l,f=e*e,v=[],y=0;y<this.shells.length&&!((a=this.shells[y]).radius2>f);y++)for(n=Math.max(Math.min(~~(u+a.h),this.numCellsH-1),0),i=Math.max(Math.min(~~(p+a.v),this.numCellsV-1),0),r=(s=this.cells[i*this.numCellsH+n]).length,o=0;o<r;o++)(h=(c=s[o].pos)[0]-t[0])*h+(c=c[1]-t[1])*c<=f&&v.push(s[o]);return v}search(t,e,i=1/0,n=[]){if(null==t.pos)return this.searchPosition(t,e);var r=t.pos;null==e&&(e=t.size||1);for(var o,a,s,h,c,l,u,p,f,v=1/this.cellSize,y=r[0]*v,m=r[1]*v,d=e*e,w=n.length=0;w<this.shells.length&&!((l=this.shells[w]).radius2>d);w++)for(a=Math.max(Math.min(~~(y+l.h),this.numCellsH-1),0),o=Math.max(Math.min(~~(m+l.v),this.numCellsV-1),0),s=(u=this.cells[o*this.numCellsH+a]).length,h=0;h<s;h++)if(c=u[h],t!=c&&-1===n.indexOf(c)&&(f=c.pos,p=f[0]-r[0],f=f[1]-r[1],f=p*p+f*f,f<=d&&(n.push(c),n.length>=i)))return n;return n}searchSimpler(t,e){var i=e*e,n=t[0]-e,r=t[0]+e,o=t[1]-e,a=t[1]+e,e=1/this.cellSize,s=Math.max(~~(n*e),0),h=Math.min(~~(r*e),this.numCellsH-1),o=Math.max(~~(o*e),0),c=Math.min(~~(a*e),this.numCellsV-1);let l,u,p,f,v,y,m,d,w=[];for(l=o;l<=c;l++)for(u=s;u<=h;u++)for(f=(p=this.cells[l*this.numCellsH+u]).length,v=0;v<f;v++)(m=(y=p[v].pos)[0]-t[0])*m+(d=y[1]-t[1])*d<=i&&w.push(p[v]);return w}}window.addEventListener("keydown",function(t){var e=t.key||t.keyCode;"Escape"!==e&&27!==e||requestFullscreen(canvas.parentElement),"Enter"===e&&fps.reset(),"function"==typeof key&&key("down",e),"function"==typeof keydown&&keydown(e);var i=String.fromCharCode(e).replace(/[^ -~]+/g,"");""!==i&&("function"==typeof key&&key("down",i),"function"==typeof keydown&&keydown(i),e="",t.ctrlKey&&(e+="ctrl-"),t.altKey&&(e+="alt-"),t.shiftKey&&(e+="shift-"),""!==e&&("function"==typeof key&&key("down",e+i),"function"==typeof keydown&&keydown(e+i)))},!0),canvas.addEventListener("keyup",function(t){var e=t.key||t.keyCode;"function"==typeof key&&key("up",e),"function"==typeof keyup&&keyup(e);var i=String.fromCharCode(e).replace(/[^ -~]+/g,"");""!==i&&("function"==typeof key&&key("up",i),"function"==typeof keyup&&keyup(i),e="",t.ctrlKey&&(e+="ctrl-"),t.altKey&&(e+="alt-"),t.shiftKey&&(e+="shift-"),""!==e&&("function"==typeof key&&key("up",e+i),"function"==typeof keyup&&keyup(e+i)))},!0),canvas.addEventListener("keypress",function(t){var e=String.fromCharCode(t.which).replace(/[^ -~]+/g,"");" "==e&&(updating=!updating),""!==e&&"function"==typeof key&&key("press",e),""!==e&&"function"==typeof keypress&&keypress(e),t.preventDefault()},!0),canvas.addEventListener("pointerdown",function(t){canvas.focus(),mouseevent(t,"down")},!1),canvas.addEventListener("pointerup",function(t){mouseevent(t,"up")},!1),canvas.addEventListener("pointermove",function(t){mouseevent(t,"move")},!1),canvas.addEventListener("pointerout",function(t){mouseevent(t,"out")},!1),canvas.addEventListener("pointerenter",function(t){canvas.focus(),mouseevent(t,"in")},!1),window.addEventListener("resize",onresize,!1),onresize(),requestAnimationFrame(render);